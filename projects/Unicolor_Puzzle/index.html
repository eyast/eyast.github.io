<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>World's hardest jigsaw | Eyas Taifour</title> <meta name="author" content="Eyas Taifour"> <meta name="description" content="Assembling a unicolor 2000 piece puzzle using computer vision."> <meta name="keywords" content="data-science, neural-networks, pytorch, keras, microsoft"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://eyast.github.io/projects/Unicolor_Puzzle/"> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Eyas </span>Taifour</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Portfolio</a> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">World's hardest jigsaw</h1> <p class="post-description">Assembling a unicolor 2000 piece puzzle using computer vision.</p> </header> <article> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/puzzle_final/final-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/puzzle_final/final-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/puzzle_final/final-1400.webp"></source> <img src="/assets/img/puzzle_final/final.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="2000 pieces" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> A jigsaw puzzle composed of a single color, assembled with the help of Computer Vision to detect and describe edges, and find similarities amongst them. This was originally a 2000 pieces puzzle but I've lost a piece. </div> <h2 id="project-description">Project Description</h2> <p>I explore the problem of large space constraints satisfaction with mininal, noisy information - a topic important in Operations Research and scheduling amongst others. The question is: knowing dispersed, noisy information, in which order can you arrange something to result in a most coherent solution. To test some ideas on an application, I have decided to build a program that uses computer vision techniques to solve jigsaw puzzles using only the shapes of the edges. I have also always thought it would be very cool to display a single color Jigsaw puzzle. You can find the code repository <a href="https://github.com/eyast/PuzzleGenerator" rel="external nofollow noopener" target="_blank">on Github</a>, or if you feel like solving this problemyourself, you can find the dataset (scanned copies of the jigsaw puzzle pieces, raw) <a href="https://www.kaggle.com/datasets/etaifour/jigsawpuzzle" rel="external nofollow noopener" target="_blank">here</a>.</p> <h2 id="skills">Skills</h2> <p>Computer Vision, Features Description, Feature Search, Conditional Probability, Multiprocessing, Profiling</p> <h2 id="tools">Tools</h2> <p>Python, Jupyter, cv2, numpy, sympy, scikit-learn, Pillow, cProfile</p> <h2 id="preparation-process">Preparation Process</h2> <p>I’ve decided to purchase a 2000 pieces custom Jigsaw puzzle, from the first online vendor I could find who could provide that size. They had good ratings online, and they provided a nice web page tool which allowed me to pick a custom background color and add a photo. Since my customisations were very scarce, their customer care department reached out to make sure that I haven’t made a mistake.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/puzzle_final/email_screenshot-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/puzzle_final/email_screenshot-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/puzzle_final/email_screenshot-1400.webp"></source> <img src="/assets/img/puzzle_final/email_screenshot.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Concerned customer care=good customer care" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> The people at PuzzlesPrint were concerned. That's good customer care. </div> <h3 id="indexing-digitizing">Indexing, Digitizing</h3> <p>I was unaware if those pieces were unique or not, or if they were correctly assemblable. After a bit of pondering, I’ve decided to index, scan, and organize these pieces. The process was:</p> <ol> <li>Buy a 0.2 mm pen</li> <li>Buy a 20 drawers cabinet from Bunnings</li> <li>Add a little sticker to each drawer of that cabinet, starting at 1:100, 101:200, 201:300, etc..</li> <li>Number each piece sequentially, starting from 1</li> <li>For each numbered piece, add a horizontal line above. This would then help define the baseline orientiation of the piece, and help resolve future problems (i.e. am I looking at a ‘9’ or an inverting ‘6’)</li> <li>Once all the pieces were numbered, put a batch of ~50 aligned pieces on the flatbed scanner</li> <li>Turn the lights off - you want to only rely on the flatbed scanner’s light source and not the ambient light in the room, since you only want the surface to be scanned (and not the depth of each puzzle piece)</li> <li>Scan the pieces - single channel BW</li> <li>Store the physical pieces in the appropriate drawer</li> </ol> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/puzzle_final/01_left_box_drawers-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/puzzle_final/01_left_box_drawers-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/puzzle_final/01_left_box_drawers-1400.webp"></source> <img src="/assets/img/puzzle_final/01_left_box_drawers.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="I bought a drawer with 20 compartments from my local DIY store." onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/puzzle_final/02_scanning-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/puzzle_final/02_scanning-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/puzzle_final/02_scanning-1400.webp"></source> <img src="/assets/img/puzzle_final/02_scanning.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="scanning the pieces on a flatbed scanner, in a dark room." onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/puzzle_final/03_results-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/puzzle_final/03_results-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/puzzle_final/03_results-1400.webp"></source> <img src="/assets/img/puzzle_final/03_results.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="The results of the scan." onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> I organized the physical pieces in such a way they were retrievable, and their orientiation would be known. Having 2000 pieces spread in 20 drawers made me appreciate the 'size' and 'size on disk' properties of a file system - but that's another story for another day. </div> <p>With this done I now had few JPGs of the 2000 pieces, and my task now was to identify the pieces, and ‘glue them’ together.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/puzzle_final/04_scanned_results-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/puzzle_final/04_scanned_results-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/puzzle_final/04_scanned_results-1400.webp"></source> <img src="/assets/img/puzzle_final/04_scanned_results.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="scanned results" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="assembling">Assembling</h2> <p>As soon as I was done from the tedious task of indexing, scanning, and storing all those pieces, it was time to start the real work. My thought process at this stage was not very clear and I knew the first step I had to do was to find the puzzle pieces. To do this, I opted to leverage OpenCV’s existing libraries which proved to be useful as it allowed me to blur, find thresholds, and detect contours quickly and easily. I’ve referred to the documentation and book a textbook from Amazon <a href="https://www.amazon.com.au/Computer-Vision-Applications-Richard-Szeliski/dp/3030343715/ref=sr_1_7?keywords=computer+vision&amp;qid=1669959923&amp;qu=eyJxc2MiOiIzLjQ1IiwicXNhIjoiMi4wMCIsInFzcCI6IjEuMDAifQ%3D%3D&amp;sprefix=computer+vision%2Caps%2C311&amp;sr=8-7" rel="external nofollow noopener" target="_blank">Computer Vision: Algorithms and Applications</a> which I highly recommend.</p> <p>Since the scanned copies had noise (dust) and since I had written the sequence of each piece, openCV returned a lot of connected components but I was only interested in the larger ones. To find these large ones, without hardcoding anything, I’ve relied on <code class="language-plaintext highlighter-rouge">sklearn.cluster.KMeans</code> with <code class="language-plaintext highlighter-rouge">n_clusters=2</code> to help me find the ‘large components - The resulting bounding box allowed me to divide this view into smaller chunks.</p> <p>To assemble, the process was to :</p> <ol> <li>Find large components on each sheet of paper using <code class="language-plaintext highlighter-rouge">cv2.connectedComponents</code> and using this information to cut a bounding box</li> <li>Draw individual contours in a new numpy array using <code class="language-plaintext highlighter-rouge">cv2.drawContours</code> </li> <li>Look for the value closest to the array’s corners, to determine the piece’s corners. This populated the list of edges quickly, but incorrectly</li> <li>Build a GUI using OpenCV that allowed me to reposition the location of the corners</li> <li>Codify Top, Right, Down, Left into 0, 1, 2, 3 and rotations of 90, 180, 270 (clockwise) to 0, 1, 2</li> <li>Cut each piece into 4 sides, and rotate the sides <em>n</em> degrees to have them all parallel to a horizontal line using <code class="language-plaintext highlighter-rouge">sympy.geometry.geo</code> - any geometric modifications made to individual pieces were saved to a custom python dictionary that I’ve built.</li> </ol> <h2 id="calculating-features">Calculating features</h2> <p>I played around with the calculations of individual features and vectorized them. Surprisingly, the least descriptive feature was the most performing. my winning choice was [width, height, x_loc_of_higher_point]. I then calculated the distance of each vector vs. the remainder using a leangthy loop that I distributed using python’s <code class="language-plaintext highlighter-rouge">multiprocessing</code> package and profiled using <code class="language-plaintext highlighter-rouge">cProfile</code> - this helped me tremendously understand where there were bottlenecks in my code.</p> <h2 id="solving-the-complete-puzzle">Solving the complete puzzle</h2> <p>Using conditional probability, I started looking for pieces that could satisfy multiple constraints at once, updating my beliefes at every point. Over time, assembling the puzle became a lot easier and less prone to recommendation errors.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/puzzle_final/06_assembly-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/puzzle_final/06_assembly-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/puzzle_final/06_assembly-1400.webp"></source> <img src="/assets/img/puzzle_final/06_assembly.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="some dispersed pieces" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Some dispersed pieces on the table. </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/puzzle_final/07-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/puzzle_final/07-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/puzzle_final/07-1400.webp"></source> <img src="/assets/img/puzzle_final/07.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="some dispersed pieces" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Edge and Corner pieces are the best to start with - they have the least amount of constraints to satisfy, and they do constraint the second layer of pieces very nicely. </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/puzzle_final/08-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/puzzle_final/08-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/puzzle_final/08-1400.webp"></source> <img src="/assets/img/puzzle_final/08.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="some dispersed pieces" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Once the border is built, Conditional Proability can be employed to help solve it. </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/puzzle_final/09-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/puzzle_final/09-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/puzzle_final/09-1400.webp"></source> <img src="/assets/img/puzzle_final/09.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Taking shape" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 Eyas Taifour. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-PNPQFZFHEJ"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-PNPQFZFHEJ");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>